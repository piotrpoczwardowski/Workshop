<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <style>
      .grid {
        display: flex;
        flex-direction: column;
        width: 800px;
        margin: 0 auto;
        flex-wrap: wrap;
      }

      .gridRow {
        display: flex;
        justify-content: space-around;
      }

      .gridCell {
        height: 80px;
        width: 80px;
        flex-grow: 1;
        background: gray;
        box-sizing: border-box;
        border: 2px solid white;
        box-sizing: border-box;
      }

      .move {
        background: rgba(187, 50, 50, 0.678);
      }
      .selected {
        border: 5px solid rgb(21, 189, 15);
      }
      .moveRange {
        background: rgba(255, 166, 0, 0.527);
      }
      .warriorRed {
        background: rgb(121, 7, 7);
      }

      .assassinRed {
        background: rgb(255, 0, 0);
      }

      .warriorBlue {
        background: rgb(11, 22, 126);
      }
      .assassinBlue {
        background: rgb(0, 26, 255);
      }
      .attack {
        transition: all, 0.5s;
      }
      .attack:hover {
        border: 5px solid purple;
      }
    </style>
  </head>
  <body>
    <div class="grid"></div>
    <script>
      var grid = document.querySelector(".grid");
      for (var i = 0; i < 10; i++) {
        var row = document.createElement("div");
        row.classList.add("gridRow");
        grid.appendChild(row);
        for (var j = 0; j < 10; j++) {
          var cell = document.createElement("div");
          cell.classList.add("gridCell");
          cell.setAttribute("data-y", i + 1);
          cell.setAttribute("data-x", j + 1);
          row.appendChild(cell);
        }
      }

      var startPositionWarriorRedTeam = document.querySelector(
        `[data-x="${2}"][data-y="${2}"]`
      );
      var warriorRed = startPositionWarriorRedTeam;
      warriorRed.classList.add("warriorRed", "player", "red");
      warriorRed.setAttribute("type", "warrior");

      var startPositionWarriorBlueTeam = document.querySelector(
        `[data-x="${9}"][data-y="${2}"]`
      );
      var warriorBlue = startPositionWarriorBlueTeam;
      warriorBlue.classList.add("warriorBlue", "player", "blue");
      warriorBlue.setAttribute("type", "warrior");

      var startPositionAssassinRedTeam = document.querySelector(
        `[data-x="${2}"][data-y="${5}"]`
      );
      var assassinRed = startPositionAssassinRedTeam;
      assassinRed.classList.add("assassinRed", "player", "red");
      assassinRed.setAttribute("type", "assassin");

      var startPositionAssassinBlueTeam = document.querySelector(
        `[data-x="${9}"][data-y="${5}"]`
      );
      var assassinBlue = startPositionAssassinBlueTeam;
      assassinBlue.classList.add("assassinBlue", "player", "blue");
      assassinBlue.setAttribute("type", "assassin");

      var allCells = document.querySelectorAll(".gridCell");
      var freeCells = document.querySelectorAll(".gridCell:not(.player)");
      var redTeamPawns = document.querySelectorAll(".red");
      var blueTeamPawns = document.querySelectorAll(".blue");
      var bothTeams = document.querySelectorAll(".red, .blue");
      var selectedPawn;
      var round = 0;
      var moveRange;

      var players = {
        teams: {
          red: {
            color: "red",
            enemy: 'blue',
            pawns: {
              warrior: {
                moveRange: 1
              },
              assassin: {
                moveRange: 3
              }
            }
          },
          blue: {
            color: "blue",
            enemy: 'red',
            pawns: {
              warrior: {
                moveRange: 1
              },
              assassin: {
                moveRange: 3
              }
            }
          }
        }
      };

      whoPlay = round % 2 === 0 ? players.teams.red : players.teams.blue;

      allCells.forEach(function(pawn) {
        pawn.addEventListener("click", function() {
          removeSelected();

          if (this.classList.contains(whoPlay.color)) {
            removeMoveRange();
            this.classList.add("selected");
            selectedPawn = document.querySelector(".selected");
            pawnType = selectedPawn.getAttribute("type");
            checkRange(selectedPawn, whoPlay);
          }
          if (this.classList.contains("moveRange")) {
            selectedPawn.classList.remove(
              pawnType + whoPlay.color.capitalize(),
              "player",
              whoPlay.color
            );
            selectedPawn.removeAttribute("type");
            this.classList.add(
              pawnType + whoPlay.color.capitalize(),
              "player",
              whoPlay.color
            );
            this.setAttribute("type", pawnType);

            removeMoveRange();
            updatePositions();
          }
        });
      });

      function checkRange(pawn, whoPlay) {
        let range = whoPlay.pawns[pawnType].moveRange
        let enemy = whoPlay.enemy
        pawnX = getPosition(pawn).x;
        pawnY = getPosition(pawn).y;
        
        for (var i = 0; i < 4; i++) {
          for (var j = 1; j < range + 1; j++) {
            var x;
            var y;
            if (i === 0) {
              x = j;
              y = 0;
            }
            if (i === 1) {
              x = 0;
              y = j;
            }
            if (i === 2) {
              x = -j;
              y = 0;
            }
            if (i === 3) {
              x = 0;
              y = -j;
            }

            var next = document.querySelector(som(pawnX + x, pawnY + y));
           
            if (next) {
              if (next.classList.contains("player")) {
                if(next.classList.contains(enemy)){
                  next.classList.add('attack')
                }
                break;
              }
              next.classList.add("moveRange");
            }
          }
        }
      }

      function som(x, y) {
        return `[data-x='${x}'][data-y='${y}']`;
      }
      function getPosition(cell) {
        return {
          x: parseInt(cell.getAttribute("data-x")),
          y: parseInt(cell.getAttribute("data-y"))
        };
      }

      String.prototype.capitalize = function() {
        return this.charAt(0).toUpperCase() + this.slice(1);
      };

      function updatePositions() {
        whoPlay = round % 2 === 0 ? players.teams.red : players.teams.blue;
        freeCells = document.querySelectorAll(".gridCell:not(.player)");
        redTeamPawns = document.querySelectorAll(".red");
        blueTeamPawns = document.querySelectorAll(".blue");
        bothTeams = document.querySelectorAll(".red, .blue");
      }

      function markRange(pawn, range) {
        let pawnX = parseInt(pawn.getAttribute("data-x"));
        let pawnY = parseInt(pawn.getAttribute("data-y"));

        for (var i = range; i >= 1; i--) {
          moveRange = document.querySelectorAll(
            `[data-x="${pawnX + i}"][data-y="${pawnY}"], [data-x="${pawnX -
              i}"][data-y="${pawnY}"],[data-x="${pawnX}"][data-y="${pawnY +
              i}"], [data-x="${pawnX}"][data-y="${pawnY - i}"]`
          );
          moveRange.forEach(function(cell) {
            cell.classList.add("moveRange");
          });
        }
        moveRange = document.querySelectorAll(".moveRange");
      }

      function removeSelected() {
        allCells.forEach(function(cell) {
          cell.classList.remove("selected");
        });
      }

      function removeMoveRange() {
        allCells.forEach(function(cell) {
          cell.classList.remove("moveRange", 'attack');
        });
      }
    </script>
  </body>
</html>
